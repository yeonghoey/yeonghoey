<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>GNU Make</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">GNU Make</h1>
</header>
<h1 id="table-of-contents">Table of Contents <span class="tag" data-tag-name="TOC_3_gh"><span class="smallcaps">TOC_3_gh</span></span></h1>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#topics">Topics</a>
<ul>
<li><a href="#makefile">Makefile</a>
<ul>
<li><a href="#include">Include</a></li>
<li><a href="#evaluation">Evaluation</a></li>
<li><a href="#wildcard">Wildcard</a></li>
<li><a href="#parallel-execution">Parallel Execution</a></li>
<li><a href="#recursive-use-of-make">Recursive Use of make</a></li>
</ul></li>
<li><a href="#rules">Rules</a>
<ul>
<li><a href="#multiple-rules-for-one-target">Multiple Rules for One Target</a></li>
<li><a href="#static-pattern-rules">Static Pattern Rules</a></li>
<li><a href="#implicit-rules">Implicit Rules</a></li>
<li><a href="#pattern-rules">Pattern Rules</a></li>
</ul></li>
<li><a href="#targets">Targets</a>
<ul>
<li><a href="#phony-targets">Phony Targets</a></li>
</ul></li>
<li><a href="#prerequisites">Prerequisites</a>
<ul>
<li><a href="#vpath">VPATH</a></li>
</ul></li>
<li><a href="#recipes">Recipes</a>
<ul>
<li><a href="#echoing">Echoing</a></li>
<li><a href="#shell-for-recipe">Shell for Recipe</a></li>
<li><a href="#errors-in-recipes">Errors in Recipes</a></li>
<li><a href="#canned-recipes">Canned Recipes</a></li>
</ul></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#conditionals">Conditionals</a></li>
<li><a href="#functions">Functions</a>
<ul>
<li><a href="#define-custom-functions">Define custom functions</a></li>
</ul></li>
<li><a href="#cli">CLI</a></li>
<li><a href="#conventions">Conventions</a></li>
</ul></li>
<li><a href="#reference">Reference</a>
<ul>
<li><a href="#filter-out-patterntext">$(filter-out pattern…,text)</a></li>
</ul></li>
<li><a href="#how-to">How-to</a>
<ul>
<li><a href="#manage-background-processes">Manage background processes</a></li>
</ul></li>
<li><a href="#links">Links</a></li>
</ul>
<h1 id="overview">Overview</h1>
<p>Simple usage of <a href="https://github.com/requests/requests/blob/master/Makefile">requests</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">.PHONY:</span><span class="dt"> docs</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="dv">init:</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  pip install pipenv --upgrade</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  pipenv install --dev --skip-lock</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="dv">test:</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="co"># This runs all of the tests, on both Python 2 and Python 3.</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  detox</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="dv">ci:</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  pipenv run py.test -n 8 --boxed --junitxml=report.xml</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="dv">test-readme:</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="ch">@</span><span class="fu">pipenv run python setup.py check --restructuredtext --strict &amp;&amp; ([ </span><span class="ch">$$</span><span class="fu">? -eq 0 ] &amp;&amp; echo </span><span class="st">&quot;README.rst and HISTORY.rst ok&quot;</span><span class="fu">) || echo </span><span class="st">&quot;Invalid markup in README.rst or HISTORY.rst!&quot;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="dv">flake8:</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  pipenv run flake8 --ignore=E501,F401,E128,E402,E731,F821 requests</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="dv">coverage:</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  pipenv run py.test --cov-config .coveragerc --verbose --cov-report term --cov-report xml --cov=requests tests</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="dv">publish:</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  pip install <span class="st">&#39;twine&gt;=1.5.0&#39;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  python setup.py sdist bdist_wheel</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">  twine upload dist/*</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">  rm -fr build dist .egg requests.egg-info</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="dv">docs:</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">  cd docs &amp;&amp; make html</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">  <span class="ch">@</span><span class="fu">echo </span><span class="st">&quot;\033[95m\n\nBuild successful! View the docs homepage at docs/_build/html/index.html.\n\033[0m&quot;</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Features-of-GNU-make" class="uri">https://www.gnu.org/software/make/manual/make.html#Features-of-GNU-make</a></li>
</ul>
<h1 id="topics">Topics</h1>
<h2 id="makefile">Makefile</h2>
<p>The file name can be one of <code>GNUmakefile</code>, <code>makefile</code> and <code>Makefile</code>, but <code>Makefile</code> is mostly recommended.</p>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Makefile-Names.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Makefile-Names.html</a></li>
</ul>
<h3 id="include">Include</h3>
<ul>
<li>Include other makefiles</li>
<li><p>Static file names, wildcards, variables are all supported:</p>
<pre class="example"><code>include foo *.mk $(bar)
</code></pre></li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Include.html#Include" class="uri">https://www.gnu.org/software/make/manual/html_node/Include.html#Include</a></li>
</ul>
<h3 id="evaluation">Evaluation</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="dt">immediate </span><span class="ch">=</span><span class="st"> deferred</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="dt">immediate </span><span class="ch">?=</span><span class="st"> deferred</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="dt">immediate </span><span class="ch">:=</span><span class="st"> immediate</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="dv">immediate :</span><span class="dt">:= immediate</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="dt">immediate </span><span class="ch">+=</span><span class="st"> deferred or immediate</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">immediate <span class="dt">!</span><span class="ch">=</span><span class="st"> immediate</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="dv">immediate :</span><span class="dt"> immediate ; deferred</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        deferred</a></code></pre></div>
<dl>
<dt>immediate</dt>
<dd>Expanded during when <code>Makefile</code> is parsed, included, etc.
</dd>
<dt>deferred</dt>
<dd>Expanded during when other expanding rule requires it or actual invoking(target-update)
</dd>
</dl>
<p>You can take advantage of <code>.SECONDEXPANSION</code> special rule and <code>$$</code> to defer expanding some prerequisites:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ot">.SECONDEXPANSION:</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="dt">AVAR </span><span class="ch">=</span><span class="st"> top</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="dv">onefile:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">AVAR</span><span class="ch">)</span><span class="dt">   </span><span class="co"># top</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="dv">twofile:</span><span class="dt"> </span><span class="ch">$$</span><span class="dt">(AVAR)  </span><span class="co"># bottom</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="dt">AVAR </span><span class="ch">=</span><span class="st"> bottom</span></a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ot">.SECONDEXPANSION:</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="dt">main_OBJS </span><span class="ch">:=</span><span class="st"> main.o try.o test.o</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="dv">main:</span><span class="dt"> </span><span class="ch">$$</span><span class="dt">(</span><span class="ch">$$</span><span class="dt">@_OBJS)</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co"># After the first phase:</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#   $($@_OBJS) </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># During the second phase:</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#   $(main_OBJS) =&gt;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#   main.o try.o test.o</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Variable-Assignment" class="uri">https://www.gnu.org/software/make/manual/make.html#Variable-Assignment</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Secondary-Expansion-1" class="uri">https://www.gnu.org/software/make/manual/make.html#Secondary-Expansion-1</a></li>
</ul>
<h3 id="wildcard">Wildcard</h3>
<ul>
<li>Wildcard expansions within the definitions of targets and prerequisites are done by <code>make</code></li>
<li>For recipes, it is done by the <code>shell</code></li>
<li>Variables don't just expand wildcards, <strong>they expand only when they are used in targets or prerequisites</strong></li>
<li>To explicitly expand the wildcard in a variable, Use <code>$(wildcard var)</code></li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Wildcard-Examples-1" class="uri">https://www.gnu.org/software/make/manual/make.html#Wildcard-Examples-1</a></li>
</ul>
<h3 id="parallel-execution">Parallel Execution</h3>
<ul>
<li><code>-j</code> or <code>--jobs</code></li>
<li><code>-j 3</code> :: run 3 recipes in parallel</li>
<li><code>-l 2.5</code> :: limit parallelism by load average of <code>2.5</code></li>
<li><code>.NOTPARALLEL</code> :: inhibit parallelism</li>
</ul>
<p>To force some targets to run parallel:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="dv">foo:</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> --jobs <span class="st">&#39;bar&#39;</span> <span class="st">&#39;baz&#39;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="dv">bar:</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  echo <span class="st">&#39;bar&#39;</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="dv">baz:</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  echo <span class="st">&#39;baz&#39;</span></a></code></pre></div>
<ul>
<li><code>--output-sync</code> option is not supported the default macOS <code>make</code> (GNU Make 3.81)</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Parallel.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Parallel.html</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Parallel-Output.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Parallel-Output.html</a></li>
</ul>
<h3 id="recursive-use-of-make">Recursive Use of make</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="dv">subsystem:</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">        <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -C subdir</a></code></pre></div>
<ul>
<li><code>$(MAKE)</code> is the path of <code>make</code> executable that is invoked</li>
<li>Some flags for <code>make</code> is passed automatically through <code>MAKEFLAGS</code></li>
<li>The options <code>-C</code>, <code>-f</code>, <code>-o</code>, and <code>-W</code> are not put into <code>MAKEFLAGS</code>;</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Recursion.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Recursion.html</a></li>
</ul>
<h2 id="rules">Rules</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="dv">target … :</span><span class="dt"> prerequisites …</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">        recipe</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">        …</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">        …</a></code></pre></div>
<dl>
<dt><em>target</em></dt>
<dd><p>usually the name of a file, can also be the name of an action (<a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">Phony Targets</a>)</p>
<dl>
<dt><em>Phony Targets</em></dt>
<dd>Not refer a file but just the name of an action. They are not prerequisites of something, or does not require some other prerequisites
</dd>
</dl>
</dd>
<dt><em>prerequisite</em></dt>
<dd><p>the names of files that the target depends on</p>
</dd>
<dt><em>recipe</em></dt>
<dd><p>must be indented with <code>\t</code>, or set <code>.RECIPEPREFIX</code> to your taste</p>
</dd>
</dl>
<ul>
<li><em>Line break</em> : Like many other languages, place <code>\</code> at the end of the line. Backslash/newlines are converted into a single space character. Once that is done, all whitespace around the backslash/newline is condensed into a single space</li>
</ul>
<p>When execute the command <code>make &lt;target&gt;</code>:</p>
<ol>
<li>Reads the <code>Makefile</code> in the currenty directory</li>
<li>Pick <code>&lt;target&gt;</code>'s rule or the first rule if <code>&lt;target&gt;</code> is omitted</li>
<li>Process the rule recursively:
<ol>
<li>Process the rule's prerequisites</li>
<li>Run its own recipe if some of its prerequisites are newer than its own target.</li>
</ol></li>
</ol>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Introduction.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Introduction.html</a></li>
</ul>
<h3 id="multiple-rules-for-one-target">Multiple Rules for One Target</h3>
<ul>
<li>All the prerequisites mentioned in all the rules are <strong>merged</strong> into one list</li>
<li>There can only be one recipe to be executed for a file.</li>
<li>When there are serverl recipes for a file, <code>make</code> uses the last one given and prints an error message.</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Multiple-Rules-for-One-Target" class="uri">https://www.gnu.org/software/make/manual/make.html#Multiple-Rules-for-One-Target</a></li>
</ul>
<h3 id="static-pattern-rules">Static Pattern Rules</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="dt">objects </span><span class="ch">=</span><span class="st"> foo.o bar.o</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">objects</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="dv">$(objects):</span><span class="dt"> %.o: %.c</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">        <span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -c <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$&lt;</span> -o <span class="ch">$@</span></a></code></pre></div>
<ul>
<li>Each pattern normally contains the character <code>%</code> just once.</li>
<li><code>$&lt;</code> is the automatic variable that hold the name matched by <code>%</code></li>
<li><code>$@</code> is the automatic variable that hold the name of the target</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Syntax-of-Static-Pattern-Rules" class="uri">https://www.gnu.org/software/make/manual/make.html#Syntax-of-Static-Pattern-Rules</a></li>
</ul>
<h3 id="implicit-rules">Implicit Rules</h3>
<ul>
<li>Each implicit rule has a target pattern and prerequisite patterns</li>
<li>There are built-in rules for common languages</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="dv">x:</span><span class="dt"> y.o z.o</span></a></code></pre></div>
<p>when x.c, y.c and z.c all exist will execute:</p>
<pre class="shell"><code>cc -c x.c -o x.o
cc -c y.c -o y.o
cc -c z.c -o z.o
cc x.o y.o z.o -o x
rm -f x.o
rm -f y.o
rm -f z.o
</code></pre>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Using-Implicit-Rules" class="uri">https://www.gnu.org/software/make/manual/make.html#Using-Implicit-Rules</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Catalogue-of-Rules" class="uri">https://www.gnu.org/software/make/manual/make.html#Catalogue-of-Rules</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Variables-Used-by-Implicit-Rules" class="uri">https://www.gnu.org/software/make/manual/make.html#Variables-Used-by-Implicit-Rules</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Implicit-Rule-Search-Algorithm" class="uri">https://www.gnu.org/software/make/manual/make.html#Implicit-Rule-Search-Algorithm</a></li>
</ul>
<h3 id="pattern-rules">Pattern Rules</h3>
<ul>
<li>A pattern rule contains the character <code>%</code> (exactly one of them) in the target</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Specifies how to make a file n.o, with another file n.c as its prerequisite,</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co"># provided that n.c exists or can be made.</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="dv">%.o :</span><span class="dt"> %.c ; recipe…</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Defining-and-Redefining-Pattern-Rules" class="uri">https://www.gnu.org/software/make/manual/make.html#Defining-and-Redefining-Pattern-Rules</a></li>
</ul>
<h2 id="targets">Targets</h2>
<ul>
<li>There are special built-in target names to adjust <code>make</code> behaviors</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Special-Targets" class="uri">https://www.gnu.org/software/make/manual/make.html#Special-Targets</a></li>
</ul>
<h3 id="phony-targets">Phony Targets</h3>
<ul>
<li>Prevent the name collision between files and actions</li>
<li>Prevent rules from not being treated as a implicit rule.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ot">.PHONY:</span><span class="dt"> clean</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="dv">clean:</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">        rm *.o temp</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="dt">SUBDIRS </span><span class="ch">=</span><span class="st"> foo bar baz</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="ot">.PHONY:</span><span class="dt"> subdirs </span><span class="ch">$(</span><span class="dt">SUBDIRS</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="dv">subdirs:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">SUBDIRS</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="dv">$(SUBDIRS):</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">        <span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -C <span class="ch">$@</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="dv">foo:</span><span class="dt"> baz</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets-1" class="uri">https://www.gnu.org/software/make/manual/make.html#Phony-Targets-1</a></li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<dl>
<dt>Normal</dt>
<dd>Just a usual thing
</dd>
<dt>Order-only</dt>
<dd>Placed after <code>|</code>, just specify the dependency, but not triggers the target even if it's newer.
</dd>
</dl>
<div class="sourceCode" id="cb15"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="dv">a:</span><span class="dt"> b</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    touch a</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="dv">b:</span><span class="dt"> c</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    touch b</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="dv">c:</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    touch c</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="dv">x:</span><span class="dt"> | y</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">    touch x</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="dv">y:</span><span class="dt"> | z</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">    touch y</a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="dv">z:</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">    touch z</a></code></pre></div>
<pre class="example"><code>$ make a
touch c
touch b
touch a
$ make x
touch z
touch y
touch x
$ make a
make: `a&#39; is up to date.
$ make x
make: `x&#39; is up to date.
$ touch c
$ make a
touch b
touch a
$ touch z
$ make x
make: `x&#39; is up to date.
$ rm c
$ make a
touch c
touch b
touch a
$ rm z
$ make x
touch z
</code></pre>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Types-of-Prerequisites" class="uri">https://www.gnu.org/software/make/manual/make.html#Types-of-Prerequisites</a></li>
<li><a href="https://stackoverflow.com/questions/24821611/order-only-prerequisites-not-working-correctly-in-gnu-make" class="uri">https://stackoverflow.com/questions/24821611/order-only-prerequisites-not-working-correctly-in-gnu-make</a></li>
</ul>
<h3 id="vpath">VPATH</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># &#39;src&#39; and &#39;../headers&#39; are searched for all prerequisites</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="dt">VPATH </span><span class="ch">=</span><span class="st"> src:../headers</span></a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb18-1" data-line-number="1">vpath %.c foo</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">vpath %   blish</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">vpath %.c bar</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">vpath %.c <span class="co"># clear out for %.c</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">vpath     <span class="co"># clear out for all</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#VPATH_003a-Search-Path-for-All-Prerequisites" class="uri">https://www.gnu.org/software/make/manual/make.html#VPATH_003a-Search-Path-for-All-Prerequisites</a></li>
</ul>
<h2 id="recipes">Recipes</h2>
<h3 id="echoing">Echoing</h3>
<ul>
<li>Recipe lines are echoed by default</li>
<li>When a line starts with <code>@</code>, the echoing of that line is suppressed.</li>
<li>The <code>@</code> is discarded before the line is passed to the shell.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="ch">@</span><span class="fu">echo About to make distribution files</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Recipe-Echoing" class="uri">https://www.gnu.org/software/make/manual/make.html#Recipe-Echoing</a></li>
</ul>
<h3 id="shell-for-recipe">Shell for Recipe</h3>
<ul>
<li><code>SHELL = &lt;path-to-shell&gt;</code></li>
<li><code>.SHELLFLAGS = &lt;flags&gt;</code></li>
<li><code>.ONESHELL:</code> to do all invokations in a shell</li>
<li>Unlike most variables, the variable <code>SHELL</code> is never set from the environment.</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Using-One-Shell" class="uri">https://www.gnu.org/software/make/manual/make.html#Using-One-Shell</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell-1" class="uri">https://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell-1</a></li>
</ul>
<h3 id="errors-in-recipes">Errors in Recipes</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="dv">clean:</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">        <span class="ch">-</span><span class="fu">rm -f *.o</span></a></code></pre></div>
<ul>
<li>To ignore errors in a recipe line, write a <code>-</code> at the beginning of the line’s text</li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Errors-in-Recipes" class="uri">https://www.gnu.org/software/make/manual/make.html#Errors-in-Recipes</a></li>
</ul>
<h3 id="canned-recipes">Canned Recipes</h3>
<p>When the same sequence of commands is useful in making various targets:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">define</span> <span class="dt">run-yacc </span><span class="ch">=</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">yacc <span class="ch">$(</span><span class="kw">firstword</span><span class="st"> </span><span class="ch">$^)</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">mv y.tab.c <span class="ch">$@</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="kw">endef</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="dv">foo.c :</span><span class="dt"> foo.y</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">        <span class="ch">$(</span><span class="dt">run-yacc</span><span class="ch">)</span></a></code></pre></div>
<h2 id="variables">Variables</h2>
<ul>
<li>Variable names like <code>.UPPERCASE</code> may be given special meaning in future versions of make.</li>
<li>Variable names are <strong>case-sensitive</strong></li>
<li>It is traditional to use upper case letters in variable names</li>
<li>It is recommended to use <strong>lower case letters</strong> for variable names that serve <strong>internal purposes in the makefile</strong></li>
<li>Every environment variable that <code>make</code> sees <strong>when it starts up is transformed into</strong> a <code>make</code> variable with the same name and value.</li>
<li><strong>Explicit assignments will override the variables from environment.</strong></li>
<li>When <code>make</code> runs a recipe, variables defined in the <code>Makefile</code> are placed into the environment of each shell.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># recursively expanded variable</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co"># -----------------------------</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="dt">foo </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">bar</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="dt">bar </span><span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">ugh</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="dt">ugh </span><span class="ch">=</span><span class="st"> Huh?</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="dv">all:</span><span class="dt">;echo </span><span class="ch">$(</span><span class="dt">foo</span><span class="ch">)</span><span class="dt">  </span><span class="co"># prints &#39;Huh?&#39;, by recursive expansion</span></a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># simply expanded variable</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co"># ------------------------</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co"># For GNU make, &#39;::=&#39; is equivalent to &#39;:=&#39;</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co"># POSIX standard only supports &#39;::=&#39;</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="dt">x </span><span class="ch">:=</span><span class="st"> foo</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="dt">y </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">x</span><span class="ch">)</span><span class="st"> bar  # evaluated right away</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="dt">x </span><span class="ch">:=</span><span class="st"> later</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="dv">all:</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11">  echo <span class="ch">$(</span><span class="dt">y</span><span class="ch">)</span>  <span class="co"># prints &#39;foo bar&#39;</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12">  echo <span class="ch">$(</span><span class="dt">x</span><span class="ch">)</span>  <span class="co"># prints &#39;later&#39;</span></a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="dt">foo </span><span class="ch">:=</span><span class="st"> a.o b.o c.o</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="dt">bar </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">foo</span><span class="er">:</span><span class="dt">.o</span><span class="er">=</span><span class="dt">.c</span><span class="ch">)</span><span class="st">    # substitution</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="dt">bar </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">foo</span><span class="er">:</span><span class="dt">%.o</span><span class="er">=</span><span class="dt">%.c</span><span class="ch">)</span><span class="st">  # same as above</span></a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># like setdefulat</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="dt">FOO </span><span class="ch">?=</span><span class="st"> bar  # set a value only if it’s not already set</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co"># Equivalent to above</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="kw">origin</span><span class="st"> FOO</span><span class="ch">)</span>, undefined)</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">  <span class="dt">FOO </span><span class="ch">=</span><span class="st"> bar</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="cf">endif</span></a></code></pre></div>
<dl>
<dt><a href="https://www.gnu.org/software/make/manual/html_node/Origin-Function.html#Origin-Function">$(origin variable)</a></dt>
<dd>tell the source of the variable, like <code>undefined</code>, <code>environment</code>, <code>default</code>, etc.
</dd>
</dl>
<div class="sourceCode" id="cb26"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Set the ouptut of a shell execution to the variable</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">hash <span class="dt">!</span><span class="ch">=</span><span class="st"> printf &#39;\043&#39;</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">file_list <span class="dt">!</span><span class="ch">=</span><span class="st"> find . -name &#39;*.c&#39;</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co"># Equivalent to above</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="dt">hash </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> printf &#39;\043&#39;</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="dt">var </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find . -name &quot;*.c&quot;</span><span class="ch">)</span></a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="dt">objects </span><span class="ch">+=</span><span class="st"> another.o</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co"># Equivalent to above</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="dt">objects </span><span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">objects</span><span class="ch">)</span><span class="st"> another.o</span></a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># Target specific variable, wil be inherited by dependent targets</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="dv">prog :</span><span class="dt"> CFLAGS = -g</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="dv">prog :</span><span class="dt"> prog.o foo.o bar.o</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="dt">EXTRA_CFLAGS </span><span class="ch">=</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="dv">prog:</span><span class="dt"> private EXTRA_CFLAGS = -L/usr/local/lib  </span><span class="co"># not inherited</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="dv">prog:</span><span class="dt"> a.o b.o</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#How-to-Use-Variables" class="uri">https://www.gnu.org/software/make/manual/make.html#How-to-Use-Variables</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Flavors.html#Flavors" class="uri">https://www.gnu.org/software/make/manual/html_node/Flavors.html#Flavors</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Other-Special-Variables" class="uri">https://www.gnu.org/software/make/manual/make.html#Other-Special-Variables</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Automatic-Variables-1" class="uri">https://www.gnu.org/software/make/manual/make.html#Automatic-Variables-1</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Target_002dspecific.html" class="uri">https://www.gnu.org/software/make/manual/html_node/Target_002dspecific.html</a></li>
</ul>
<h2 id="conditionals">Conditionals</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="dt">libs_for_gcc </span><span class="ch">=</span><span class="st"> -lgnu</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="dt">normal_libs </span><span class="ch">=</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="dv">foo:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">objects</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span>,gcc)</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">        <span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -o foo <span class="ch">$(</span><span class="dt">objects</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">libs_for_gcc</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="cf">else</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8">        <span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -o foo <span class="ch">$(</span><span class="dt">objects</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">normal_libs</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="cf">endif</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Conditional-Parts-of-Makefiles" class="uri">https://www.gnu.org/software/make/manual/make.html#Conditional-Parts-of-Makefiles</a></li>
</ul>
<h2 id="functions">Functions</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="ch">$(</span><span class="dt">function</span><span class="er"> </span><span class="dt">arguments</span><span class="ch">)</span></a></code></pre></div>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Functions.html#Functions" class="uri">https://www.gnu.org/software/make/manual/html_node/Functions.html#Functions</a></li>
</ul>
<h3 id="define-custom-functions">Define custom functions</h3>
<ul>
<li>There is no explicit function definition, but it can be mimicked using <a href="https://www.gnu.org/software/make/manual/html_node/Multi_002dLine.html#Multi_002dLine">define</a> directive along with <a href="https://www.gnu.org/software/make/manual/html_node/Call-Function.html#Call-Function">$(call variable,param,param,…)</a></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">define</span> foo</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">echo <span class="ch">$(</span><span class="dt">1</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw">endef</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="dv">bar:</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6">    <span class="ch">@$(</span><span class="kw">call</span><span class="st"> foo</span><span class="kw">,</span><span class="st">&#39;Hello World!&#39;</span><span class="ch">)</span></a></code></pre></div>
<h2 id="cli">CLI</h2>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#How-to-Run-make" class="uri">https://www.gnu.org/software/make/manual/make.html#How-to-Run-make</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Summary-of-Options" class="uri">https://www.gnu.org/software/make/manual/make.html#Summary-of-Options</a></li>
</ul>
<h2 id="conventions">Conventions</h2>
<ul>
<li><p>Every Makefile should contain this line:</p>
<pre class="example"><code>SHELL = /bin/sh
</code></pre></li>
</ul>
<hr />
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#General-Conventions-for-Makefiles" class="uri">https://www.gnu.org/software/make/manual/make.html#General-Conventions-for-Makefiles</a></li>
</ul>
<h1 id="reference">Reference</h1>
<h2 id="filter-out-patterntext"><a href="https://www.gnu.org/software/make/manual/html_node/Text-Functions.html">$(filter-out pattern…,text)</a></h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="dt">objects</span><span class="ch">=</span><span class="st">main1.o foo.o main2.o bar.o</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="dt">mains</span><span class="ch">=</span><span class="st">main1.o main2.o</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="ch">$(</span><span class="kw">filter-out</span><span class="st"> </span><span class="ch">$(</span><span class="dt">mains</span><span class="ch">)</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">objects</span><span class="ch">))</span> <span class="co"># foo.o bar.o</span></a></code></pre></div>
<h1 id="how-to">How-to</h1>
<h2 id="manage-background-processes">Manage background processes</h2>
<ul>
<li>Write a pid file when running a background process using shell's <code>$!</code></li>
<li>Clean up the process on stop</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="dv">test:</span><span class="dt"> db</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  pipenv run pytest</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="dv">db:</span><span class="dt"> db.pid</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="dv">db.pid:</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7">  sls dynamodb start &amp;&gt; <span class="st">&#39;db.log&#39;</span> &amp; echo <span class="st">&quot;</span><span class="ch">$$</span><span class="st">!&quot;</span> &gt; <span class="st">&#39;db.pid&#39;</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"></a>
<a class="sourceLine" id="cb34-9" data-line-number="9"><span class="dv">db-stop:</span><span class="dt"> PID  = </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> cat db.pid</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb34-10" data-line-number="10"><span class="dv">db-stop:</span><span class="dt"> PGID = </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> ps -o pgid= </span><span class="ch">$(</span><span class="dt">PID</span><span class="ch">))</span></a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="dv">db-stop:</span></a>
<a class="sourceLine" id="cb34-12" data-line-number="12">  <span class="ch">-</span><span class="fu">kill -INT -</span><span class="ch">$(</span><span class="dt">PGID</span><span class="ch">)</span></a>
<a class="sourceLine" id="cb34-13" data-line-number="13">  <span class="ch">-</span><span class="fu">rm </span><span class="st">&#39;db.pid&#39;</span></a></code></pre></div>
<h1 id="links">Links</h1>
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html" class="uri">https://www.gnu.org/software/make/manual/make.html</a></li>
</ul>
</body>
</html>
